// ============================================================
// FastOS — Boot Sector (ADead-BIB)
// ============================================================
// Custom OS format — alternative to Windows PE / Linux ELF
// ADead-BIB is the BASE. No ASM. No NASM. No GAS.
//
// This boot sector:
//   1. Initializes CPU (segments, stack)
//   2. Prints "FastOS v0.1" via BIOS INT 10h
//   3. Prints system info
//   4. Enters idle loop
//
// Compile: adB fastos boot.adB -o fastos.bin
// Test:    qemu-system-x86_64 -drive format=raw,file=fastos.bin
// ============================================================

org 0x7C00

// ---- Disable interrupts during init ----
cli

// ---- Zero segment registers ----
// xor ax, ax
raw { 0x31, 0xC0 }
// mov ds, ax
raw { 0x8E, 0xD8 }
// mov es, ax
raw { 0x8E, 0xC0 }
// mov ss, ax
raw { 0x8E, 0xD0 }

// ---- Setup stack ----
// mov sp, 0x7C00
raw { 0xBC, 0x00, 0x7C }

// ---- Enable interrupts ----
sti

// ---- Clear screen (BIOS scroll up, AL=0 = clear) ----
// mov ah, 0x06 (scroll up)
raw { 0xB4, 0x06 }
// mov al, 0x00 (clear entire window)
raw { 0xB0, 0x00 }
// mov bh, 0x0A (green on black attribute)
raw { 0xB7, 0x0A }
// mov cx, 0x0000 (upper-left corner)
raw { 0xB9, 0x00, 0x00 }
// mov dx, 0x184F (lower-right: row 24, col 79)
raw { 0xBA, 0x4F, 0x18 }
int_call(0x10)

// ---- Set cursor to top-left ----
// mov ah, 0x02 (set cursor position)
raw { 0xB4, 0x02 }
// mov bh, 0x00 (page 0)
raw { 0xB7, 0x00 }
// mov dh, 0x00 (row 0)
raw { 0xB6, 0x00 }
// mov dl, 0x00 (col 0)
raw { 0xB2, 0x00 }
int_call(0x10)

// ---- Print banner with color ----
// AH = 0x0E (teletype), BL = color (green)
raw { 0xB4, 0x0E }

// "=== FastOS v0.1 ==="
// '='
raw { 0xB0, 0x3D }
int_call(0x10)
raw { 0xB0, 0x3D }
int_call(0x10)
raw { 0xB0, 0x3D }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// 'F'
raw { 0xB0, 0x46 }
int_call(0x10)
// 'a'
raw { 0xB0, 0x61 }
int_call(0x10)
// 's'
raw { 0xB0, 0x73 }
int_call(0x10)
// 't'
raw { 0xB0, 0x74 }
int_call(0x10)
// 'O'
raw { 0xB0, 0x4F }
int_call(0x10)
// 'S'
raw { 0xB0, 0x53 }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// 'v'
raw { 0xB0, 0x76 }
int_call(0x10)
// '0'
raw { 0xB0, 0x30 }
int_call(0x10)
// '.'
raw { 0xB0, 0x2E }
int_call(0x10)
// '1'
raw { 0xB0, 0x31 }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// '='
raw { 0xB0, 0x3D }
int_call(0x10)
raw { 0xB0, 0x3D }
int_call(0x10)
raw { 0xB0, 0x3D }
int_call(0x10)

// Newline
raw { 0xB0, 0x0D }
int_call(0x10)
raw { 0xB0, 0x0A }
int_call(0x10)

// "ADead-BIB Base"
raw { 0xB4, 0x0E }
// 'A'
raw { 0xB0, 0x41 }
int_call(0x10)
// 'D'
raw { 0xB0, 0x44 }
int_call(0x10)
// 'e'
raw { 0xB0, 0x65 }
int_call(0x10)
// 'a'
raw { 0xB0, 0x61 }
int_call(0x10)
// 'd'
raw { 0xB0, 0x64 }
int_call(0x10)
// '-'
raw { 0xB0, 0x2D }
int_call(0x10)
// 'B'
raw { 0xB0, 0x42 }
int_call(0x10)
// 'I'
raw { 0xB0, 0x49 }
int_call(0x10)
// 'B'
raw { 0xB0, 0x42 }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// 'B'
raw { 0xB0, 0x42 }
int_call(0x10)
// 'a'
raw { 0xB0, 0x61 }
int_call(0x10)
// 's'
raw { 0xB0, 0x73 }
int_call(0x10)
// 'e'
raw { 0xB0, 0x65 }
int_call(0x10)

// Newline
raw { 0xB0, 0x0D }
int_call(0x10)
raw { 0xB0, 0x0A }
int_call(0x10)

// "No ASM. No PE. No ELF."
raw { 0xB4, 0x0E }
// 'N'
raw { 0xB0, 0x4E }
int_call(0x10)
// 'o'
raw { 0xB0, 0x6F }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// 'A'
raw { 0xB0, 0x41 }
int_call(0x10)
// 'S'
raw { 0xB0, 0x53 }
int_call(0x10)
// 'M'
raw { 0xB0, 0x4D }
int_call(0x10)
// '.'
raw { 0xB0, 0x2E }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// 'N'
raw { 0xB0, 0x4E }
int_call(0x10)
// 'o'
raw { 0xB0, 0x6F }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// 'P'
raw { 0xB0, 0x50 }
int_call(0x10)
// 'E'
raw { 0xB0, 0x45 }
int_call(0x10)
// '.'
raw { 0xB0, 0x2E }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// 'N'
raw { 0xB0, 0x4E }
int_call(0x10)
// 'o'
raw { 0xB0, 0x6F }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// 'E'
raw { 0xB0, 0x45 }
int_call(0x10)
// 'L'
raw { 0xB0, 0x4C }
int_call(0x10)
// 'F'
raw { 0xB0, 0x46 }
int_call(0x10)
// '.'
raw { 0xB0, 0x2E }
int_call(0x10)

// Newline
raw { 0xB0, 0x0D }
int_call(0x10)
raw { 0xB0, 0x0A }
int_call(0x10)

// "Format: FsOS"
raw { 0xB4, 0x0E }
// 'F'
raw { 0xB0, 0x46 }
int_call(0x10)
// 'o'
raw { 0xB0, 0x6F }
int_call(0x10)
// 'r'
raw { 0xB0, 0x72 }
int_call(0x10)
// 'm'
raw { 0xB0, 0x6D }
int_call(0x10)
// 'a'
raw { 0xB0, 0x61 }
int_call(0x10)
// 't'
raw { 0xB0, 0x74 }
int_call(0x10)
// ':'
raw { 0xB0, 0x3A }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// 'F'
raw { 0xB0, 0x46 }
int_call(0x10)
// 's'
raw { 0xB0, 0x73 }
int_call(0x10)
// 'O'
raw { 0xB0, 0x4F }
int_call(0x10)
// 'S'
raw { 0xB0, 0x53 }
int_call(0x10)

// Newline
raw { 0xB0, 0x0D }
int_call(0x10)
raw { 0xB0, 0x0A }
int_call(0x10)
raw { 0xB0, 0x0A }
int_call(0x10)

// "Ready."
raw { 0xB4, 0x0E }
// 'R'
raw { 0xB0, 0x52 }
int_call(0x10)
// 'e'
raw { 0xB0, 0x65 }
int_call(0x10)
// 'a'
raw { 0xB0, 0x61 }
int_call(0x10)
// 'd'
raw { 0xB0, 0x64 }
int_call(0x10)
// 'y'
raw { 0xB0, 0x79 }
int_call(0x10)
// '.'
raw { 0xB0, 0x2E }
int_call(0x10)

// ---- Halt ----
cli
hlt
// Safety: infinite loop
raw { 0xEB, 0xFE }
