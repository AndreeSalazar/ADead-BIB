// ============================================================
// FastOS — Stage 1 Boot Sector (ADead-BIB)
// ============================================================
// 512 bytes. Zero ASM. ADead-BIB generates ALL bytes.
//
// Flow:
//   1. Init CPU (segments, stack)
//   2. Clear screen (dark blue splash)
//   3. Show FastOS logo + "Booting..."
//   4. Load stage2 from disk → jump to 0x8000
//
// Auto-boot: no prompt, straight to desktop.
// Stage2 is loaded at 0x8000 (sectors 2-20 from disk)
// ============================================================

org 0x7C00

// ---- Disable interrupts during init ----
cli

// ---- Save boot drive (DL from BIOS) ----
raw { 0x88, 0x16, 0x00, 0x7E } // mov [0x7E00], dl

// ---- Zero segment registers ----
raw { 0x31, 0xC0 }       // xor ax, ax
raw { 0x8E, 0xD8 }       // mov ds, ax
raw { 0x8E, 0xC0 }       // mov es, ax
raw { 0x8E, 0xD0 }       // mov ss, ax

// ---- Setup stack at 0x7C00 ----
raw { 0xBC, 0x00, 0x7C } // mov sp, 0x7C00

// ---- Enable interrupts ----
sti

// ---- Set video mode 03h (80x25 text) ----
raw { 0xB4, 0x00 }
raw { 0xB0, 0x03 }
int_call(0x10)

// ---- Hide cursor ----
raw { 0xB4, 0x01 }
raw { 0xB9, 0x20, 0x00 }
int_call(0x10)

// ---- Set ES = 0xB800 (VGA text segment) ----
raw { 0xB8, 0x00, 0xB8 }
raw { 0x8E, 0xC0 }

// ---- Fill screen: dark blue (0x10 = black on blue) ----
raw { 0xBF, 0x00, 0x00 }
raw { 0xB9, 0xD0, 0x07 }
raw { 0xB8, 0x20, 0x17 } // white on dark blue
raw { 0xF3, 0xAB }

// ---- "FastOS" logo at row 9, col 35 (big, bright white on dark blue) ----
// (9*80+35)*2 = 1510 = 0x05E6
raw { 0xBF, 0xE6, 0x05 }
raw { 0x26, 0xC7, 0x05, 0x46, 0x1F }  // F
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x61, 0x1F }  // a
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x73, 0x1F }  // s
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x74, 0x1F }  // t
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x4F, 0x1F }  // O
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x53, 0x1F }  // S

// ---- "v1.0" at row 10, col 37 (grey) ----
// (10*80+37)*2 = 1674 = 0x068A
raw { 0xBF, 0x8A, 0x06 }
raw { 0x26, 0xC7, 0x05, 0x76, 0x18 }  // v
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x31, 0x18 }  // 1
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x2E, 0x18 }  // .
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x30, 0x18 }  // 0

// ---- "Booting..." at row 13, col 35 (yellow on dark blue) ----
// (13*80+35)*2 = 2150 = 0x0866
raw { 0xBF, 0x66, 0x08 }
raw { 0x26, 0xC7, 0x05, 0x42, 0x1E }  // B
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x6F, 0x1E }  // o
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x6F, 0x1E }  // o
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x74, 0x1E }  // t
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x69, 0x1E }  // i
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x6E, 0x1E }  // n
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x67, 0x1E }  // g
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x2E, 0x1E }  // .
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x2E, 0x1E }  // .
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x2E, 0x1E }  // .

// ---- "ADead-BIB" at row 22, col 34 (dark grey) ----
// (22*80+34)*2 = 3588 = 0x0E04
raw { 0xBF, 0x04, 0x0E }
raw { 0x26, 0xC7, 0x05, 0x41, 0x18 }  // A
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x44, 0x18 }  // D
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x65, 0x18 }  // e
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x61, 0x18 }  // a
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x64, 0x18 }  // d
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x2D, 0x18 }  // -
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x42, 0x18 }  // B
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x49, 0x18 }  // I
raw { 0x83, 0xC7, 0x02 }
raw { 0x26, 0xC7, 0x05, 0x42, 0x18 }  // B

// ============================================================
// Load stage2 from disk into 0x8000
// ============================================================
// Set ES:BX = 0x0000:0x8000
raw { 0x31, 0xC0 }       // xor ax, ax
raw { 0x8E, 0xC0 }       // mov es, ax
raw { 0xBB, 0x00, 0x80 } // mov bx, 0x8000

// AH=0x02 (read), AL=16 sectors (8KB — room for big stage2)
raw { 0xB4, 0x02 }
raw { 0xB0, 0x10 }
// CH=0 (cylinder), CL=2 (start sector 2)
raw { 0xB5, 0x00 }
raw { 0xB1, 0x02 }
// DH=0 (head 0)
raw { 0xB6, 0x00 }
// DL = boot drive (saved at 0x7E00)
raw { 0x8A, 0x16, 0x00, 0x7E }
int_call(0x13)

// ---- Jump to stage2 at 0x8000 ----
raw { 0xEA, 0x00, 0x80, 0x00, 0x00 }
