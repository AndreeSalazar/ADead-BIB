// ============================================================
// FastOS — Stage 1 Boot Sector (ADead-BIB)
// ============================================================
// The FIRST thing the CPU executes. 512 bytes. No ASM.
//
// Flow:
//   1. Init CPU (segments, stack)
//   2. Clear screen (green theme)
//   3. Print FastOS banner
//   4. Ask user: "Install FastOS? (Y/N)"
//   5. Wait for keypress
//   6. If Y → load stage2 → continue boot
//   7. If N → halt
//
// ADead-BIB generates ALL bytes. Zero ASM.
// ============================================================

org 0x7C00

// ---- Disable interrupts during init ----
cli

// ---- Zero segment registers ----
raw { 0x31, 0xC0 }       // xor ax, ax
raw { 0x8E, 0xD8 }       // mov ds, ax
raw { 0x8E, 0xC0 }       // mov es, ax
raw { 0x8E, 0xD0 }       // mov ss, ax

// ---- Setup stack at 0x7C00 ----
raw { 0xBC, 0x00, 0x7C } // mov sp, 0x7C00

// ---- Enable interrupts ----
sti

// ---- Clear screen (green on black) ----
raw { 0xB4, 0x06 }       // mov ah, 0x06 (scroll up = clear)
raw { 0xB0, 0x00 }       // mov al, 0x00 (clear all)
raw { 0xB7, 0x0A }       // mov bh, 0x0A (green on black)
raw { 0xB9, 0x00, 0x00 } // mov cx, 0x0000 (top-left)
raw { 0xBA, 0x4F, 0x18 } // mov dx, 0x184F (bottom-right 80x25)
int_call(0x10)

// ---- Cursor to (0,0) ----
raw { 0xB4, 0x02 }       // mov ah, 0x02
raw { 0xB7, 0x00 }       // mov bh, 0 (page 0)
raw { 0xB6, 0x00 }       // mov dh, 0 (row)
raw { 0xB2, 0x00 }       // mov dl, 0 (col)
int_call(0x10)

// ============================================================
// BANNER: "FastOS v1.0"
// ============================================================
raw { 0xB4, 0x0E }       // mov ah, 0x0E (teletype)

// Line 1: "=== FastOS v1.0 ==="
raw { 0xB0, 0x3D }
int_call(0x10)
raw { 0xB0, 0x3D }
int_call(0x10)
raw { 0xB0, 0x3D }
int_call(0x10)
raw { 0xB0, 0x20 }
int_call(0x10)
// 'F'
raw { 0xB0, 0x46 }
int_call(0x10)
// 'a'
raw { 0xB0, 0x61 }
int_call(0x10)
// 's'
raw { 0xB0, 0x73 }
int_call(0x10)
// 't'
raw { 0xB0, 0x74 }
int_call(0x10)
// 'O'
raw { 0xB0, 0x4F }
int_call(0x10)
// 'S'
raw { 0xB0, 0x53 }
int_call(0x10)
// ' v1.0 '
raw { 0xB0, 0x20 }
int_call(0x10)
raw { 0xB0, 0x76 }
int_call(0x10)
raw { 0xB0, 0x31 }
int_call(0x10)
raw { 0xB0, 0x2E }
int_call(0x10)
raw { 0xB0, 0x30 }
int_call(0x10)
raw { 0xB0, 0x20 }
int_call(0x10)
raw { 0xB0, 0x3D }
int_call(0x10)
raw { 0xB0, 0x3D }
int_call(0x10)
raw { 0xB0, 0x3D }
int_call(0x10)
// CR+LF
raw { 0xB0, 0x0D }
int_call(0x10)
raw { 0xB0, 0x0A }
int_call(0x10)

// Line 2: "Powered by ADead-BIB"
raw { 0xB4, 0x0E }
// "Powered by ADead-BIB"
raw { 0xB0, 0x50 }
int_call(0x10)
raw { 0xB0, 0x6F }
int_call(0x10)
raw { 0xB0, 0x77 }
int_call(0x10)
raw { 0xB0, 0x65 }
int_call(0x10)
raw { 0xB0, 0x72 }
int_call(0x10)
raw { 0xB0, 0x65 }
int_call(0x10)
raw { 0xB0, 0x64 }
int_call(0x10)
raw { 0xB0, 0x20 }
int_call(0x10)
raw { 0xB0, 0x62 }
int_call(0x10)
raw { 0xB0, 0x79 }
int_call(0x10)
raw { 0xB0, 0x20 }
int_call(0x10)
raw { 0xB0, 0x41 }
int_call(0x10)
raw { 0xB0, 0x44 }
int_call(0x10)
raw { 0xB0, 0x65 }
int_call(0x10)
raw { 0xB0, 0x61 }
int_call(0x10)
raw { 0xB0, 0x64 }
int_call(0x10)
raw { 0xB0, 0x2D }
int_call(0x10)
raw { 0xB0, 0x42 }
int_call(0x10)
raw { 0xB0, 0x49 }
int_call(0x10)
raw { 0xB0, 0x42 }
int_call(0x10)
// CR+LF
raw { 0xB0, 0x0D }
int_call(0x10)
raw { 0xB0, 0x0A }
int_call(0x10)

// Line 3: "Format: FsOS (64-bit)"
raw { 0xB4, 0x0E }
raw { 0xB0, 0x46 }
int_call(0x10)
raw { 0xB0, 0x6F }
int_call(0x10)
raw { 0xB0, 0x72 }
int_call(0x10)
raw { 0xB0, 0x6D }
int_call(0x10)
raw { 0xB0, 0x61 }
int_call(0x10)
raw { 0xB0, 0x74 }
int_call(0x10)
raw { 0xB0, 0x3A }
int_call(0x10)
raw { 0xB0, 0x20 }
int_call(0x10)
raw { 0xB0, 0x46 }
int_call(0x10)
raw { 0xB0, 0x73 }
int_call(0x10)
raw { 0xB0, 0x4F }
int_call(0x10)
raw { 0xB0, 0x53 }
int_call(0x10)
// CR+LF
raw { 0xB0, 0x0D }
int_call(0x10)
raw { 0xB0, 0x0A }
int_call(0x10)
// blank line
raw { 0xB0, 0x0A }
int_call(0x10)

// ============================================================
// INTERACTIVE PROMPT: "Install FastOS? (Y/N): "
// ============================================================
raw { 0xB4, 0x0E }
// 'I'
raw { 0xB0, 0x49 }
int_call(0x10)
// 'n'
raw { 0xB0, 0x6E }
int_call(0x10)
// 's'
raw { 0xB0, 0x73 }
int_call(0x10)
// 't'
raw { 0xB0, 0x74 }
int_call(0x10)
// 'a'
raw { 0xB0, 0x61 }
int_call(0x10)
// 'l'
raw { 0xB0, 0x6C }
int_call(0x10)
// 'l'
raw { 0xB0, 0x6C }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// 'F'
raw { 0xB0, 0x46 }
int_call(0x10)
// 'a'
raw { 0xB0, 0x61 }
int_call(0x10)
// 's'
raw { 0xB0, 0x73 }
int_call(0x10)
// 't'
raw { 0xB0, 0x74 }
int_call(0x10)
// 'O'
raw { 0xB0, 0x4F }
int_call(0x10)
// 'S'
raw { 0xB0, 0x53 }
int_call(0x10)
// '?'
raw { 0xB0, 0x3F }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)
// '('
raw { 0xB0, 0x28 }
int_call(0x10)
// 'Y'
raw { 0xB0, 0x59 }
int_call(0x10)
// '/'
raw { 0xB0, 0x2F }
int_call(0x10)
// 'N'
raw { 0xB0, 0x4E }
int_call(0x10)
// ')'
raw { 0xB0, 0x29 }
int_call(0x10)
// ':'
raw { 0xB0, 0x3A }
int_call(0x10)
// ' '
raw { 0xB0, 0x20 }
int_call(0x10)

// ============================================================
// WAIT FOR KEYPRESS (BIOS INT 16h, AH=0x00)
// ============================================================
// mov ah, 0x00 (wait for key)
raw { 0xB4, 0x00 }
int_call(0x16)
// AL now has the ASCII character

// ---- Echo the key ----
// mov ah, 0x0E (teletype)
raw { 0xB4, 0x0E }
int_call(0x10)

// CR+LF after echo
raw { 0xB4, 0x0E }
raw { 0xB0, 0x0D }
int_call(0x10)
raw { 0xB0, 0x0A }
int_call(0x10)

// ---- Check if Y/y (0x59 or 0x79) ----
// cmp al, 'Y' (0x59)
raw { 0x3C, 0x59 }
// je boot_continue (short jump +offset)
raw { 0x74, 0x04 }
// cmp al, 'y' (0x79)
raw { 0x3C, 0x79 }
// je boot_continue
raw { 0x74, 0x00 }

// ---- User said NO → print message and halt ----
raw { 0xB4, 0x0E }
// "Bye!"
raw { 0xB0, 0x42 }
int_call(0x10)
raw { 0xB0, 0x79 }
int_call(0x10)
raw { 0xB0, 0x65 }
int_call(0x10)
raw { 0xB0, 0x21 }
int_call(0x10)

cli
hlt
raw { 0xEB, 0xFE }

// ---- boot_continue: User said YES ----
// Print "Loading..."
raw { 0xB4, 0x0E }
// 'L'
raw { 0xB0, 0x4C }
int_call(0x10)
// 'o'
raw { 0xB0, 0x6F }
int_call(0x10)
// 'a'
raw { 0xB0, 0x61 }
int_call(0x10)
// 'd'
raw { 0xB0, 0x64 }
int_call(0x10)
// 'i'
raw { 0xB0, 0x69 }
int_call(0x10)
// 'n'
raw { 0xB0, 0x6E }
int_call(0x10)
// 'g'
raw { 0xB0, 0x67 }
int_call(0x10)
// '.'
raw { 0xB0, 0x2E }
int_call(0x10)
raw { 0xB0, 0x2E }
int_call(0x10)
raw { 0xB0, 0x2E }
int_call(0x10)

// For now: halt after "Loading..." (stage2 will be loaded here later)
cli
hlt
raw { 0xEB, 0xFE }
